---
title : æ¥å£è‡ªåŠ¨åŒ–æµ‹è¯•
date: 2021-12-26
updated : 2023-04-21 13:06:54
photos: https://share.lain.buzz/api/name/requests-sidebar.webp?path=/ğŸ–¼%20Picture/å›¾åºŠ/åšå®¢/requests-sidebar.webp
categories: 
- [æµ‹è¯•, æ¥å£è‡ªåŠ¨åŒ–æµ‹è¯•]
tags: 
- è‡ªåŠ¨åŒ–æµ‹è¯•
- æ¥å£
- Python
- requests
- unittest
---

åŸºäº requests åº“ å’Œ unittest åº“ï¼Œç¼–å†™çš„è„šæœ¬ demoï¼Œè¿˜å­˜åœ¨ä¸æˆç†Ÿçš„åœ°æ–¹ã€‚

<!--more-->


# å‡†å¤‡

å‡†å¤‡åº“ [requests](https://docs.python-requests.org/zh_CN/latest/) å’Œ [unittest](https://docs.python.org/zh-cn/3/library/unittest.html)

```python
pip install requests
```

# ç¼–å†™æµ‹è¯•è„šæœ¬

## å°è£…å…¬å…±å‚æ•°

å°è£…å…¬å…±å‚æ•°ï¼Œé‡å¤è°ƒå–ç»“æœï¼Œå‡å°‘ä»£ç çš„ç¼–å†™é‡ï¼Œé™ä½ç†è§£éš¾åº¦ã€‚

è®¾ç½®æ¥å£çš„å¿…å¡«å‚æ•°ï¼Œå¹¶ä½¿ç”¨ *args ä¼ å…¥æ¥å£çš„éå¿…å¡«å‚æ•°ï¼›ä½¿ç”¨ \**kwargs è®¾ç½®ä¸€äº›æ¡ä»¶ã€‚
å¯ä»¥å°†ä¸€äº›å…¬å…±å‚æ•°å†™å…¥åˆ°å•ç‹¬çš„æ–‡ä»¶ä¸­ï¼Œä½¿ç”¨æ—¶å¼•ç”¨å³å¯ï¼›ä¸€äº›éšç§çš„æ•°æ®å¯ä»¥å†™å…¥åˆ°[#ç¯å¢ƒå˜é‡ä¸­](/tags/ç¯å¢ƒå˜é‡)ä¸­ï¼Œå¦‚æµ‹è¯• api æˆ–è€…æµ‹è¯•è´¦å·ã€‚

```python
import requests
import unittest

class RequestTest(unittest.TestCase):
	
 	# å°è£…å…¬å…±å‚æ•°
	 def common(self, name, password, *args, **kwargs):
		url = f"{config.ENVIRONMENT}/auth/login"
		param = {"name":name, "password":password,}
		
		if args: # å¦‚æœ args ä¸ä¸ºç©º åˆ™å°†å‚æ•°ä¼ å…¥æ·»åŠ åˆ°è¯·æ±‚å‚æ•°ä¸­
			 for arg in args:
				 param.update(**arg)
		self.response = requests.post(url, headers=self.headers, json=param, 
									  verify=False,)

		 # å¦‚æœ kwargs ä¸ä¸º False åˆ™è¿›è¡Œç›¸åº”çš„æ“ä½œ
		if kwargs:
			for key, value in kwargs.items():
				if key == 'del_' and value : # å¦‚æœ key ä¸º del_ åˆ™åˆ é™¤æœ¬æ¬¡æµ‹è¯•æ‰€äº§ç”Ÿçš„æ•°æ®
					self.db.commit_data(f"delete from mp_org where phone='{phone}'")

		return self.response

if __name__ == '__main__':
	unittest.main(verbosity=2)
```

è°ƒå–å…¬å…±å‚æ•°ï¼Œè¯·æ±‚é¡¹ç›®çš„å¤–éƒ¨æ¥å£è·å–è¯·æ±‚ç»“æœ, å¹¶æ ¹æ®ç»“æœè¿›è¡Œæ–­è¨€

```python

class RequestTest(unittest.TestCase):
	
	... skip
	
	def test_login(self):
		self.common(name='admin', password='passwd')
		
		# æ–­è¨€
		self.assertEqual(self.response.status_code, 200)
 		self.assertEqual(self.response.json()['code'], 0, msg='è¿”å›çš„çŠ¶æ€ç ä¸ä¸º0')
		
if __name__ == '__main__':
	unittest.main(verbosity=2)
```

## ç¼–å†™è£…é¥°å™¨

å°†ç›¸åŒçš„æ–­è¨€æ”¾å…¥ [#è£…é¥°å™¨](https://docs.python.org/zh-cn/3/library/typing.html#functions-and-decorators)ä¸­ï¼Œä»¥ä¾›é‡å¤ä½¿ç”¨

```python
# decorators.py

def lsgot_success(f):

	@wraps(f)
	def decorator(self, *args, **kwargs):
		f(self, *args, **kwargs)
		responseJSON = self.response.json()
		print(responseJSON)
		self.assertEqual(self.response.status_code, 200,)
		self.assertEqual(responseJSON['code'], 0, msg='è¿”å›çš„çŠ¶æ€ç ä¸ä¸º0')
		return f(self, *args, **kwargs)
	return decorator
```

ä¿®æ”¹æµ‹è¯•æ–¹æ³•

```python
from decorators import lsgot_success

class RequestTest(unittest.TestCase):
	
	... skip
	
	@lsgot_success
	def test_login(self):
		self.common(name='admin', password='passwd')
		
if __name__ == '__main__':
	unittest.main(verbosity=2)
```

è‹¥æ¥å£éœ€è¦ cookie ä¹‹ç±»çš„å‡­è¯ï¼Œå¯ä»¥ç¼–å†™å•ç‹¬çš„æ–¹æ³•ï¼Œåœ¨è¿è¡Œæµ‹è¯•ä¹‹å‰å†™å…¥åˆ° cookie æˆ–è€… headers ä¸­ã€‚

```python
def login():

	response = requests.post(url=url, headers=config.CONFING.LOGIN_HEADERS, 
							 data=param, verify=False)
	
	# è·å–ç™»å½•ç»“æœè¿”å›çš„å“åº”ï¼Œ å¹¶å°† Authorization å†™å…¥åˆ° headers ä¸­ã€‚
	headers = {
		"Authorization": f"Bearer {response.json()['access_token']}",
		"Content-Type": "application/json;charset=UTF-8"
		}
	return headers

class RequestTest(unittest.TestCase):
	
	def setUp(self):
		self.headers = login()

... skip

if __name__ == '__main__':
	
	unittest.main(verbosity=2)
```

å¦‚æœåœ¨æµ‹è¯•è¿‡ç¨‹ä¸­éœ€è¦è®¿é—®æ•°æ®åº“ï¼Œè®¿é—®è¿™ç¯‡æ–‡ç« [åœ¨ Python ä¸­è®¿é—® SQL]()

è°¢è°¢

# å‚è€ƒ

[1] ç”±äºé“¾æ¥æ¶ˆå¤±ï¼Œæš‚æ—¶æ— æ³•å±•ç¤ºï¼Œä»¥åæ‰¾åˆ°åè¡¥ä¸Š

